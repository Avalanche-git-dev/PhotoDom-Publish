# # ============================
# # 7. Grafana
# # ============================
# apiVersion: v1
# kind: ConfigMap
# metadata:
#   name: grafana-datasources
#   labels:
#     app: grafana
#     component: datasource
#   namespace: default
#   annotations:
#     grafana_datasource: "1"
# data:
#   datasources.yml: |
#     apiVersion: 1
#     datasources:
#       - name: Loki
#         type: loki
#         access: proxy
#         url: http://loki:3100
#         isDefault: true
# ---
# apiVersion: apps/v1
# kind: Deployment
# metadata:
#   name: grafana
# spec:
#   replicas: 1
#   selector:
#     matchLabels:
#       app: grafana
#   template:
#     metadata:
#       labels:
#         app: grafana
#     spec:
#       containers:
#       - name: grafana
#         image: grafana/grafana:10.1.0
#         ports:
#         - containerPort: 3000
#         env:
#         - name: GF_AUTH_ANONYMOUS_ENABLED
#           value: "true"
#         - name: GF_AUTH_ANONYMOUS_ORG_ROLE
#           value: Admin
#         - name: GF_AUTH_DISABLE_LOGIN_FORM
#           value: "true"
#         volumeMounts:
#         - name: grafana-datasources
#           mountPath: /etc/grafana/provisioning/datasources/
#         - name: grafana-dashboard
#           mountPath: /etc/grafana/provisioning/dashboards/
#         - name: grafana-dashboard-config
#           mountPath: /var/lib/grafana/dashboards/
#         resources:
#           requests:
#             memory: "128Mi"
#             cpu: "100m"
#           limits:
#             memory: "256Mi"
#             cpu: "250m"
#       volumes:
#       - name: grafana-datasources
#         configMap:
#           name: grafana-datasources
#       - name: grafana-dashboard
#         configMap:
#           name: grafana-dashboard
#       - name: grafana-dashboard-config
#         configMap:
#           name: grafana-dashboard-config
# ---
# apiVersion: v1
# kind: ConfigMap
# metadata:
#   name: grafana-dashboard
#   labels:
#     app: grafana
#     component: dashboard
#   namespace: default
#   annotations:
#     grafana_dashboard: "1"
# data:
#   dashboard.yaml: |
#     apiVersion: 1
#     providers:
#       - name: 'default'
#         orgId: 1
#         folder: ''
#         type: file
#         disableDeletion: false
#         editable: true
#         options:
#           path: /var/lib/grafana/dashboards/
# ---
# apiVersion: v1
# kind: ConfigMap
# metadata:
#   name: grafana-dashboard-config
#   labels:
#     app: grafana
#     component: dashboards-json
#   namespace: default
#   annotations:
#     grafana_dashboard_config: "1"
# data:
#   photodom-dashboard.json: |
#     REPLACE_ME_DASHBOARD_JSON
# ---
# apiVersion: v1
# kind: Service
# metadata:
#   name: grafana
# spec:
#   selector:
#     app: grafana
#   ports:
#   - port: 3000
#     targetPort: 3000
# apiVersion: v1
# kind: ConfigMap
# metadata:
#   name: grafana-dashboard-config
#   labels:
#     grafana_dashboard: "1"
# data:
#   photodom-dashboard.json: |
#     {{ inserire qui contenuto minificato del file JSON della dashboard se vuoi inline }}
# ---
# apiVersion: apps/v1
# kind: Deployment
# metadata:
#   name: grafana
# spec:
#   replicas: 1
#   selector:
#     matchLabels:
#       app: grafana
#   template:
#     metadata:
#       labels:
#         app: grafana
#     spec:
#       containers:
#       - name: grafana
#         image: grafana/grafana:10.1.0
#         ports:
#         - containerPort: 3000
#         env:
#         - name: GF_AUTH_ANONYMOUS_ENABLED
#           value: "true"
#         - name: GF_AUTH_ANONYMOUS_ORG_ROLE
#           value: Admin
#         - name: GF_AUTH_DISABLE_LOGIN_FORM
#           value: "true"
#         volumeMounts:
#         - name: grafana-datasources
#           mountPath: /etc/grafana/provisioning/datasources
#         - name: grafana-dashboard
#           mountPath: /etc/grafana/provisioning/dashboards
#         - name: dashboard-json
#           mountPath: /var/lib/grafana/dashboards
#            resources:
# #           requests:
# #             memory: "128Mi"
# #             cpu: "100m"
# #           limits:
# #             memory: "256Mi"
# #             cpu: "250m"
#       volumes:
#       - name: grafana-datasources
#         configMap:
#           name: grafana-datasources
#       - name: grafana-dashboard
#         configMap:
#           name: grafana-dashboard
#       - name: dashboard-json
#         configMap:
#           name: grafana-dashboard-config
# ---
# apiVersion: v1
# kind: Service
# metadata:
#   name: grafana
# spec:
#   selector:
#     app: grafana
#   ports:
#   - port: 3000
#     targetPort: 3000
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-datasources
  labels:
    grafana_datasource: "1"
data:
  datasources.yaml: |
    apiVersion: 1
    datasources:
      - name: Prometheus
        type: prometheus
        access: proxy
        url: http://prometheus:9090
        editable: false
        jsonData:
          httpMethod: POST

      - name: Loki
        type: loki
        uid: loki
        access: proxy
        orgId: 1
        url: http://loki:3100
        basicAuth: false
        isDefault: false
        version: 1
        editable: false
        apiVersion: 1
        jsonData: {}      
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-provider
  labels:
    grafana_dashboard_provider: "1"
data:
  dashboard-provider.yaml: |
    apiVersion: 1
    providers:
      - name: 'default'
        orgId: 1
        folder: ''
        type: file
        disableDeletion: false
        updateIntervalSeconds: 10
        options:
          path: /etc/grafana/dashboards
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-config
  labels:
    grafana_dashboard: "1"
data:
  photodom-dashboard.json: |
    {"annotations":{"list":[{"builtIn":1,"datasource":{"type":"grafana","uid":"-- Grafana --"},"enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations & Alerts","target":{"limit":100,"matchAny":false,"tags":[],"type":"dashboard"},"type":"dashboard"}]},"description":"Dashboard for Spring Boot2 Statistics(by micrometer-prometheus).","editable":true,"fiscalYearStartMonth":0,"gnetId":6756,"graphTooltip":0,"id":2,"links":[],"liveNow":false,"panels":[{"collapsed":false,"datasource":{"type":"prometheus","uid":"DxTyMDjnk"},"gridPos":{"h":1,"w":24,"x":0,"y":0},"id":54,"panels":[],"title":"Basic Statistics","type":"row"},{"datasource":{"type":"prometheus","uid":"PBFA97CFB590B2093"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"decimals":1,"mappings":[{"options":{"match":"null","result":{"text":"N/A"}},"type":"special"}],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"s"},"overrides":[]},"gridPos":{"h":3,"w":6,"x":0,"y":1},"id":52,"links":[],"maxDataPoints":100,"options":{"colorMode":"value","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"10.1.0","targets":[{"datasource":"PBFA97CFB590B2093","expr":"process_uptime_seconds{application=\"$application\", instance=\"$instance\"}","format":"time_series","intervalFactor":2,"legendFormat":"","metric":"","refId":"A","step":14400}],"title":"Uptime","type":"stat"},{"datasource":{"type":"prometheus","uid":"PBFA97CFB590B2093"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"decimals":1,"mappings":[{"options":{"match":"null","result":{"text":"N/A"}},"type":"special"}],"max":100,"min":0,"thresholds":{"mode":"absolute","steps":[{"color":"rgba(50, 172, 45, 0.97)","value":null},{"color":"rgba(237, 129, 40, 0.89)","value":70},{"color":"rgba(245, 54, 54, 0.9)","value":90}]},"unit":"percent"},"overrides":[]},"gridPos":{"h":6,"w":5,"x":6,"y":1},"id":58,"links":[],"maxDataPoints":100,"options":{"orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"showThresholdLabels":false,"showThresholdMarkers":true},"pluginVersion":"10.1.0","targets":[{"datasource":"PBFA97CFB590B2093","expr":"sum(jvm_memory_used_bytes{application=\"$application\", instance=\"$instance\", area=\"heap\"})*100/sum(jvm_memory_max_bytes{application=\"$application\",instance=\"$instance\", area=\"heap\"})","format":"time_series","intervalFactor":1,"legendFormat":"","refId":"A","step":14400}],"title":"Heap Used","type":"gauge"},{"datasource":{"type":"prometheus","uid":"PBFA97CFB590B2093"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"decimals":1,"mappings":[{"options":{"match":"null","result":{"text":"N/A"}},"type":"special"},{"options":{"from":-1e+32,"result":{"text":"N/A"},"to":0},"type":"range"}],"max":100,"min":0,"thresholds":{"mode":"absolute","steps":[{"color":"rgba(50, 172, 45, 0.97)","value":null},{"color":"rgba(237, 129, 40, 0.89)","value":70},{"color":"rgba(245, 54, 54, 0.9)","value":90}]},"unit":"percent"},"overrides":[]},"gridPos":{"h":6,"w":5,"x":11,"y":1},"id":60,"links":[],"maxDataPoints":100,"options":{"orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"showThresholdLabels":false,"showThresholdMarkers":true},"pluginVersion":"10.1.0","targets":[{"datasource":"PBFA97CFB590B2093","expr":"sum(jvm_memory_used_bytes{application=\"$application\", instance=\"$instance\", area=\"nonheap\"})*100/sum(jvm_memory_max_bytes{application=\"$application\",instance=\"$instance\", area=\"nonheap\"})","format":"time_series","intervalFactor":2,"legendFormat":"","refId":"A","step":14400}],"title":"Non-Heap Used","type":"gauge"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"PBFA97CFB590B2093"},"fill":1,"fillGradient":0,"gridPos":{"h":6,"w":8,"x":16,"y":1},"hiddenSeries":false,"id":66,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"10.1.0","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"datasource":"PBFA97CFB590B2093","expr":"process_files_open{application=\"$application\", instance=\"$instance\"}","format":"time_series","intervalFactor":1,"legendFormat":"Open Files","refId":"A"},{"datasource":"PBFA97CFB590B2093","expr":"process_files_max{application=\"$application\", instance=\"$instance\"}","format":"time_series","intervalFactor":1,"legendFormat":"Max Files","refId":"B"}],"thresholds":[],"timeRegions":[],"title":"Process Open Files","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"format":"locale","logBase":1,"show":true},{"format":"short","logBase":1,"show":true}],"yaxis":{"align":false}},{"datasource":{"type":"prometheus","uid":"PBFA97CFB590B2093"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[{"options":{"match":"null","result":{"text":"N/A"}},"type":"special"}],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"dateTimeAsIso"},"overrides":[]},"gridPos":{"h":3,"w":6,"x":0,"y":4},"id":56,"links":[],"maxDataPoints":100,"options":{"colorMode":"value","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"10.1.0","targets":[{"datasource":"PBFA97CFB590B2093","expr":"process_start_time_seconds{application=\"$application\", instance=\"$instance\"}*1000","format":"time_series","intervalFactor":2,"legendFormat":"","metric":"","refId":"A","step":14400}],"title":"Start time","type":"stat"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"PBFA97CFB590B2093"},"fill":1,"fillGradient":0,"gridPos":{"h":7,"w":12,"x":0,"y":7},"hiddenSeries":false,"id":95,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"10.1.0","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"datasource":"PBFA97CFB590B2093","expr":"system_cpu_usage{instance=\"$instance\", application=\"$application\"}","format":"time_series","intervalFactor":1,"legendFormat":"System CPU Usage","refId":"A"},{"datasource":"PBFA97CFB590B2093","expr":"process_cpu_usage{instance=\"$instance\", application=\"$application\"}","format":"time_series","intervalFactor":1,"legendFormat":"Process CPU Usage","refId":"B"}],"thresholds":[],"timeRegions":[],"title":"CPU Usage","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"format":"short","logBase":1,"show":true},{"format":"short","logBase":1,"show":true}],"yaxis":{"align":false}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"PBFA97CFB590B2093"},"fill":1,"fillGradient":0,"gridPos":{"h":7,"w":12,"x":12,"y":7},"hiddenSeries":false,"id":96,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"10.1.0","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"datasource":"PBFA97CFB590B2093","expr":"system_load_average_1m{instance=\"$instance\", application=\"$application\"}","format":"time_series","intervalFactor":1,"legendFormat":"Load Average [1m]","refId":"A"},{"datasource":"PBFA97CFB590B2093","expr":"system_cpu_count{instance=\"$instance\", application=\"$application\"}","format":"time_series","intervalFactor":1,"legendFormat":"CPU Core Size","refId":"B"}],"thresholds":[],"timeRegions":[],"title":"Load Average","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"format":"short","logBase":1,"show":true},{"format":"short","logBase":1,"show":true}],"yaxis":{"align":false}},{"collapsed":false,"datasource":{"type":"prometheus","uid":"DxTyMDjnk"},"gridPos":{"h":1,"w":24,"x":0,"y":14},"id":48,"panels":[],"title":"JVM Statistics - Memory","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"PBFA97CFB590B2093"},"fill":1,"fillGradient":0,"gridPos":{"h":8,"w":8,"x":0,"y":15},"hiddenSeries":false,"id":85,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"10.1.0","pointradius":5,"points":false,"renderer":"flot","repeat":"memory_pool_heap","repeatDirection":"h","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"datasource":"PBFA97CFB590B2093","expr":"jvm_memory_used_bytes{instance=\"$instance\", application=\"$application\", id=\"$memory_pool_heap\"}","format":"time_series","intervalFactor":1,"legendFormat":"Used","refId":"C"},{"datasource":"PBFA97CFB590B2093","expr":"jvm_memory_committed_bytes{instance=\"$instance\", application=\"$application\", id=\"$memory_pool_heap\"}","format":"time_series","intervalFactor":1,"legendFormat":"Commited","refId":"A"},{"datasource":"PBFA97CFB590B2093","expr":"jvm_memory_max_bytes{instance=\"$instance\", application=\"$application\", id=\"$memory_pool_heap\"}","format":"time_series","intervalFactor":1,"legendFormat":"Max","refId":"B"}],"thresholds":[],"timeRegions":[],"title":"$memory_pool_heap (heap)","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"format":"bytes","logBase":1,"show":true},{"format":"short","logBase":1,"show":true}],"yaxis":{"align":false}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"PBFA97CFB590B2093"},"fill":1,"fillGradient":0,"gridPos":{"h":8,"w":8,"x":0,"y":23},"hiddenSeries":false,"id":88,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"8.5.2","pointradius":5,"points":false,"renderer":"flot","repeat":"memory_pool_nonheap","repeatDirection":"h","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"datasource":"PBFA97CFB590B2093","expr":"jvm_memory_used_bytes{instance=\"$instance\", application=\"$application\", id=\"$memory_pool_nonheap\"}","format":"time_series","intervalFactor":1,"legendFormat":"Used","refId":"C"},{"datasource":"PBFA97CFB590B2093","expr":"jvm_memory_committed_bytes{instance=\"$instance\", application=\"$application\", id=\"$memory_pool_nonheap\"}","format":"time_series","intervalFactor":1,"legendFormat":"Commited","refId":"A"},{"datasource":"PBFA97CFB590B2093","expr":"jvm_memory_max_bytes{instance=\"$instance\", application=\"$application\", id=\"$memory_pool_nonheap\"}","format":"time_series","intervalFactor":1,"legendFormat":"Max","refId":"B"}],"thresholds":[],"timeRegions":[],"title":"$memory_pool_nonheap (non-heap)","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"format":"bytes","logBase":1,"show":true},{"format":"short","logBase":1,"show":true}],"yaxis":{"align":false}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"PBFA97CFB590B2093"},"decimals":0,"fill":1,"gridPos":{"h":8,"w":12,"x":0,"y":31},"id":50,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"datasource":"PBFA97CFB590B2093","expr":"jvm_classes_loaded{instance=\"$instance\", application=\"$application\"}","format":"time_series","intervalFactor":1,"legendFormat":"Classes Loaded","refId":"A"}],"thresholds":[],"title":"Classes Loaded","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"decimals":0,"format":"locale","label":"","logBase":1,"show":true},{"format":"short","logBase":1,"show":true}],"yaxis":{"align":false}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"PBFA97CFB590B2093"},"fill":1,"fillGradient":0,"gridPos":{"h":8,"w":12,"x":12,"y":31},"hiddenSeries":false,"id":80,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"8.5.2","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"datasource":"PBFA97CFB590B2093","expr":"irate(jvm_classes_unloaded_total{instance=\"$instance\", application=\"$application\"}[5m])","format":"time_series","intervalFactor":1,"legendFormat":"Classes Unloaded","refId":"A"}],"thresholds":[],"timeRegions":[],"title":"Classes Unloaded","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"format":"short","logBase":1,"show":true},{"format":"short","logBase":1,"show":true}],"yaxis":{"align":false}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"PBFA97CFB590B2093"},"fill":1,"gridPos":{"h":7,"w":12,"x":0,"y":39},"id":82,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"datasource":"PBFA97CFB590B2093","expr":"jvm_buffer_memory_used_bytes{instance=\"$instance\", application=\"$application\", id=\"direct\"}","format":"time_series","intervalFactor":1,"legendFormat":"Used Bytes","refId":"A"},{"datasource":"PBFA97CFB590B2093","expr":"jvm_buffer_total_capacity_bytes{instance=\"$instance\", application=\"$application\", id=\"direct\"}","format":"time_series","intervalFactor":1,"legendFormat":"Capacity Bytes","refId":"B"}],"thresholds":[],"title":"Direct Buffers","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"format":"short","logBase":1,"show":true},{"format":"short","logBase":1,"show":true}],"yaxis":{"align":false}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"PBFA97CFB590B2093"},"fill":1,"fillGradient":0,"gridPos":{"h":7,"w":12,"x":12,"y":39},"hiddenSeries":false,"id":83,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"8.5.2","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"datasource":"PBFA97CFB590B2093","expr":"jvm_buffer_memory_used_bytes{instance=\"$instance\", application=\"$application\", id=\"mapped\"}","format":"time_series","intervalFactor":1,"legendFormat":"Used Bytes","refId":"A"},{"datasource":"PBFA97CFB590B2093","expr":"jvm_buffer_total_capacity_bytes{instance=\"$instance\", application=\"$application\", id=\"mapped\"}","format":"time_series","intervalFactor":1,"legendFormat":"Capacity Bytes","refId":"B"}],"thresholds":[],"timeRegions":[],"title":"Mapped Buffers","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"format":"short","logBase":1,"show":true},{"format":"short","logBase":1,"show":true}],"yaxis":{"align":false}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"PBFA97CFB590B2093"},"fill":1,"gridPos":{"h":8,"w":12,"x":0,"y":46},"id":68,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"datasource":"PBFA97CFB590B2093","expr":"jvm_threads_daemon{instance=\"$instance\", application=\"$application\"}","format":"time_series","intervalFactor":1,"legendFormat":"Daemon","refId":"A"},{"datasource":"PBFA97CFB590B2093","expr":"jvm_threads_live{instance=\"$instance\", application=\"$application\"}","format":"time_series","intervalFactor":1,"legendFormat":"Live","refId":"B"},{"datasource":"PBFA97CFB590B2093","expr":"jvm_threads_peak{instance=\"$instance\", application=\"$application\"}","format":"time_series","intervalFactor":1,"legendFormat":"Peak","refId":"C"}],"thresholds":[],"title":"Threads","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"format":"short","logBase":1,"show":true},{"format":"short","logBase":1,"show":true}],"yaxis":{"align":false}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"PBFA97CFB590B2093"},"fill":1,"gridPos":{"h":8,"w":12,"x":12,"y":46},"id":78,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"datasource":"PBFA97CFB590B2093","expr":"irate(jvm_gc_memory_allocated_bytes_total{instance=\"$instance\", application=\"$application\"}[5m])","format":"time_series","intervalFactor":1,"legendFormat":"allocated","refId":"A"},{"datasource":"PBFA97CFB590B2093","expr":"irate(jvm_gc_memory_promoted_bytes_total{instance=\"$instance\", application=\"$application\"}[5m])","format":"time_series","intervalFactor":1,"legendFormat":"promoted","refId":"B"}],"thresholds":[],"title":"Memory Allocate/Promote","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"format":"bytes","logBase":1,"show":true},{"format":"short","logBase":1,"show":true}],"yaxis":{"align":false}},{"collapsed":false,"datasource":{"type":"prometheus","uid":"DxTyMDjnk"},"gridPos":{"h":1,"w":24,"x":0,"y":54},"id":72,"panels":[],"title":"JVM Statistics - GC","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"PBFA97CFB590B2093"},"fill":1,"gridPos":{"h":10,"w":12,"x":0,"y":55},"id":74,"legend":{"alignAsTable":true,"avg":true,"current":false,"hideEmpty":true,"hideZero":true,"max":true,"min":true,"show":true,"total":true,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"datasource":"PBFA97CFB590B2093","expr":"irate(jvm_gc_pause_seconds_count{instance=\"$instance\", application=\"$application\"}[5m])","format":"time_series","intervalFactor":1,"legendFormat":"{{action}} [{{cause}}]","refId":"A"}],"thresholds":[],"title":"GC Count","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"format":"locale","logBase":1,"show":true},{"format":"short","logBase":1,"show":true}],"yaxis":{"align":false}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"PBFA97CFB590B2093"},"fill":1,"gridPos":{"h":10,"w":12,"x":12,"y":55},"id":76,"legend":{"alignAsTable":true,"avg":true,"current":false,"hideEmpty":true,"hideZero":true,"max":true,"min":true,"show":true,"total":true,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"datasource":"PBFA97CFB590B2093","expr":"irate(jvm_gc_pause_seconds_sum{instance=\"$instance\", application=\"$application\"}[5m])","format":"time_series","intervalFactor":1,"legendFormat":"{{action}} [{{cause}}]","refId":"A"}],"thresholds":[],"title":"GC Stop the World Duration","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"format":"s","logBase":1,"show":true},{"format":"short","logBase":1,"show":true}],"yaxis":{"align":false}},{"collapsed":false,"datasource":{"type":"prometheus","uid":"DxTyMDjnk"},"gridPos":{"h":1,"w":24,"x":0,"y":65},"id":34,"panels":[],"title":"HikariCP Statistics","type":"row"},{"datasource":{"type":"prometheus","uid":"PBFA97CFB590B2093"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[{"options":{"match":"null","result":{"text":"N/A"}},"type":"special"}],"thresholds":{"mode":"absolute","steps":[{"color":"green"},{"color":"red","value":80}]},"unit":"none"},"overrides":[]},"gridPos":{"h":4,"w":4,"x":0,"y":66},"id":44,"links":[],"maxDataPoints":100,"options":{"colorMode":"none","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"8.5.2","targets":[{"datasource":"PBFA97CFB590B2093","expr":"hikaricp_connections{instance=\"$instance\", application=\"$application\", pool=\"$hikaricp\"}","format":"time_series","intervalFactor":1,"legendFormat":"","refId":"A"}],"title":"Connections Size","type":"stat"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"PBFA97CFB590B2093"},"fill":1,"gridPos":{"h":8,"w":20,"x":4,"y":66},"id":36,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"hideZero":false,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":true,"steppedLine":false,"targets":[{"datasource":"PBFA97CFB590B2093","expr":"hikaricp_connections_active{instance=\"$instance\", application=\"$application\", pool=\"$hikaricp\"}","format":"time_series","intervalFactor":1,"legendFormat":"Active","refId":"B"},{"datasource":"PBFA97CFB590B2093","expr":"hikaricp_connections_idle{instance=\"$instance\", application=\"$application\", pool=\"$hikaricp\"}","format":"time_series","intervalFactor":1,"legendFormat":"Idle","refId":"A"},{"datasource":"PBFA97CFB590B2093","expr":"hikaricp_connections_pending{instance=\"$instance\", application=\"$application\", pool=\"$hikaricp\"}","format":"time_series","intervalFactor":1,"legendFormat":"Pending","refId":"C"}],"thresholds":[],"title":"Connections","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"format":"short","logBase":1,"show":true},{"format":"short","logBase":1,"show":true}],"yaxis":{"align":false}},{"datasource":{"type":"prometheus","uid":"PBFA97CFB590B2093"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[{"options":{"match":"null","result":{"text":"N/A"}},"type":"special"}],"thresholds":{"mode":"absolute","steps":[{"color":"green"},{"color":"red","value":80}]},"unit":"none"},"overrides":[]},"gridPos":{"h":4,"w":4,"x":0,"y":70},"id":46,"links":[],"maxDataPoints":100,"options":{"colorMode":"none","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"8.5.2","targets":[{"datasource":"PBFA97CFB590B2093","expr":"hikaricp_connections_timeout_total{instance=\"$instance\", application=\"$application\", pool=\"$hikaricp\"}","format":"time_series","intervalFactor":1,"legendFormat":"","refId":"A"}],"title":"Connection Timeout Count","type":"stat"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"PBFA97CFB590B2093"},"fill":1,"gridPos":{"h":6,"w":8,"x":0,"y":74},"id":38,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"datasource":"PBFA97CFB590B2093","expr":"hikaricp_connections_creation_seconds_sum{instance=\"$instance\", application=\"$application\", pool=\"$hikaricp\"} / hikaricp_connections_creation_seconds_count{instance=\"$instance\", application=\"$application\", pool=\"$hikaricp\"}","format":"time_series","intervalFactor":1,"legendFormat":"Creation Time","refId":"A"}],"thresholds":[],"title":"Connection Creation Time","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"format":"s","logBase":1,"show":true},{"format":"short","logBase":1,"show":true}],"yaxis":{"align":false}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"PBFA97CFB590B2093"},"fill":1,"gridPos":{"h":6,"w":8,"x":8,"y":74},"id":42,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"datasource":"PBFA97CFB590B2093","expr":"hikaricp_connections_usage_seconds_sum{instance=\"$instance\", application=\"$application\", pool=\"$hikaricp\"} / hikaricp_connections_usage_seconds_count{instance=\"$instance\", application=\"$application\", pool=\"$hikaricp\"}","format":"time_series","intervalFactor":1,"legendFormat":"Usage Time","refId":"A"}],"thresholds":[],"title":"Connection Usage Time","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"format":"s","logBase":1,"show":true},{"format":"short","logBase":1,"show":true}],"yaxis":{"align":false}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"PBFA97CFB590B2093"},"fill":1,"gridPos":{"h":6,"w":8,"x":16,"y":74},"id":40,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"datasource":"PBFA97CFB590B2093","expr":"hikaricp_connections_acquire_seconds_sum{instance=\"$instance\", application=\"$application\", pool=\"$hikaricp\"} / hikaricp_connections_acquire_seconds_count{instance=\"$instance\", application=\"$application\", pool=\"$hikaricp\"}","format":"time_series","intervalFactor":1,"legendFormat":"Acquire Time","refId":"A"}],"thresholds":[],"title":"Connection Acquire Time","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"format":"s","logBase":1,"show":true},{"format":"short","logBase":1,"show":true}],"yaxis":{"align":false}},{"collapsed":false,"datasource":{"type":"prometheus","uid":"DxTyMDjnk"},"gridPos":{"h":1,"w":24,"x":0,"y":80},"id":18,"panels":[],"title":"HTTP Statistics","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"PBFA97CFB590B2093"},"fill":1,"gridPos":{"h":7,"w":24,"x":0,"y":81},"id":4,"legend":{"alignAsTable":true,"avg":false,"current":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"datasource":"PBFA97CFB590B2093","expr":"irate(http_server_requests_seconds_count{instance=\"$instance\", application=\"$application\", uri!~\".*actuator.*\"}[5m])","format":"time_series","intervalFactor":1,"legendFormat":"{{method}} [{{status}}] - {{uri}}","refId":"A"}],"thresholds":[],"title":"Request Count","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"format":"none","logBase":1,"show":true},{"format":"short","logBase":1,"show":true}],"yaxis":{"align":false}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"PBFA97CFB590B2093"},"fill":1,"gridPos":{"h":7,"w":24,"x":0,"y":88},"id":2,"legend":{"alignAsTable":true,"avg":true,"current":false,"max":true,"min":true,"rightSide":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"datasource":"PBFA97CFB590B2093","expr":"irate(http_server_requests_seconds_sum{instance=\"$instance\", application=\"$application\", exception=\"None\", uri!~\".*actuator.*\"}[5m]) / irate(http_server_requests_seconds_count{instance=\"$instance\", application=\"$application\", exception=\"None\", uri!~\".*actuator.*\"}[5m])","format":"time_series","intervalFactor":1,"legendFormat":"{{method}} [{{status}}] - {{uri}}","refId":"A"}],"thresholds":[],"title":"Response Time","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"format":"s","label":"","logBase":1,"show":true},{"format":"short","logBase":1,"show":true}],"yaxis":{"align":false}},{"collapsed":false,"datasource":{"type":"prometheus","uid":"DxTyMDjnk"},"gridPos":{"h":1,"w":24,"x":0,"y":95},"id":22,"panels":[],"title":"Tomcat Statistics","type":"row"},{"datasource":{"type":"prometheus","uid":"PBFA97CFB590B2093"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[{"options":{"match":"null","result":{"text":"N/A"}},"type":"special"}],"thresholds":{"mode":"absolute","steps":[{"color":"green"},{"color":"red","value":80}]},"unit":"locale"},"overrides":[]},"gridPos":{"h":4,"w":4,"x":0,"y":96},"id":28,"links":[],"maxDataPoints":100,"options":{"colorMode":"none","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"8.5.2","targets":[{"datasource":"PBFA97CFB590B2093","expr":"tomcat_global_error_total{instance=\"$instance\", application=\"$application\"}","format":"time_series","intervalFactor":1,"legendFormat":"","refId":"A"}],"title":"Total Error Count","type":"stat"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"PBFA97CFB590B2093"},"decimals":0,"fill":1,"gridPos":{"h":7,"w":9,"x":4,"y":96},"id":24,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"datasource":"PBFA97CFB590B2093","expr":"tomcat_sessions_active_current{instance=\"$instance\", application=\"$application\"}","format":"time_series","intervalFactor":1,"legendFormat":"active sessions","refId":"A"}],"thresholds":[],"title":"Active Sessions","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"format":"none","label":"","logBase":1,"show":true},{"format":"short","logBase":1,"show":true}],"yaxis":{"align":false}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"PBFA97CFB590B2093"},"fill":1,"gridPos":{"h":7,"w":11,"x":13,"y":96},"id":26,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"datasource":"PBFA97CFB590B2093","expr":"irate(tomcat_global_sent_bytes_total{instance=\"$instance\", application=\"$application\"}[5m])","format":"time_series","intervalFactor":1,"legendFormat":"Sent Bytes","refId":"A"},{"datasource":"PBFA97CFB590B2093","expr":"irate(tomcat_global_received_bytes_total{instance=\"$instance\", application=\"$application\"}[5m])","format":"time_series","intervalFactor":1,"legendFormat":"Recieved Bytes","refId":"B"}],"thresholds":[],"title":"Sent & Recieved Bytes","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"format":"bytes","logBase":1,"show":true},{"format":"short","logBase":1,"show":true}],"yaxis":{"align":false}},{"datasource":{"type":"prometheus","uid":"PBFA97CFB590B2093"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[{"options":{"match":"null","result":{"text":"N/A"}},"type":"special"}],"thresholds":{"mode":"absolute","steps":[{"color":"green"},{"color":"red","value":80}]},"unit":"locale"},"overrides":[]},"gridPos":{"h":3,"w":4,"x":0,"y":100},"id":32,"links":[],"maxDataPoints":100,"options":{"colorMode":"none","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"8.5.2","targets":[{"datasource":"PBFA97CFB590B2093","expr":"tomcat_threads_config_max{instance=\"$instance\", application=\"$application\"}","format":"time_series","intervalFactor":1,"legendFormat":"","refId":"A"}],"title":"Thread Config Max","type":"stat"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"PBFA97CFB590B2093"},"fill":1,"gridPos":{"h":7,"w":13,"x":0,"y":103},"id":30,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"datasource":"PBFA97CFB590B2093","expr":"tomcat_threads_current{instance=\"$instance\", application=\"$application\"}","format":"time_series","intervalFactor":1,"legendFormat":"Current thread","refId":"A"},{"datasource":"PBFA97CFB590B2093","expr":"tomcat_threads_busy{instance=\"$instance\", application=\"$application\"}","format":"time_series","intervalFactor":1,"legendFormat":"Current thread busy","refId":"B"}],"thresholds":[],"title":"Threads","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"format":"short","logBase":1,"show":true},{"format":"short","logBase":1,"show":true}],"yaxis":{"align":false}},{"collapsed":false,"datasource":{"type":"prometheus","uid":"DxTyMDjnk"},"gridPos":{"h":1,"w":24,"x":0,"y":110},"id":8,"panels":[],"title":"Logback Statistics","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"PBFA97CFB590B2093"},"fill":1,"gridPos":{"h":7,"w":12,"x":0,"y":111},"id":6,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":true,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"alias":"","datasource":"PBFA97CFB590B2093","expr":"irate(logback_events_total{instance=\"$instance\", application=\"$application\", level=\"info\"}[5m])","format":"time_series","intervalFactor":1,"legendFormat":"info","rawSql":"SELECT\n  $__time(time_column),\n  value1\nFROM\n  metric_table\nWHERE\n  $__timeFilter(time_column)\n","refId":"A"}],"thresholds":[],"title":"INFO logs","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"format":"none","logBase":1,"show":true},{"format":"short","logBase":1,"show":true}],"yaxis":{"align":false}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"PBFA97CFB590B2093"},"fill":1,"gridPos":{"h":7,"w":12,"x":12,"y":111},"id":10,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":true,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"alias":"","datasource":"PBFA97CFB590B2093","expr":"irate(logback_events_total{instance=\"$instance\", application=\"$application\", level=\"error\"}[5m])","format":"time_series","intervalFactor":1,"legendFormat":"error","rawSql":"SELECT\n  $__time(time_column),\n  value1\nFROM\n  metric_table\nWHERE\n  $__timeFilter(time_column)\n","refId":"A"}],"thresholds":[],"title":"ERROR logs","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"format":"none","logBase":1,"show":true},{"format":"short","logBase":1,"show":true}],"yaxis":{"align":false}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"PBFA97CFB590B2093"},"fill":1,"gridPos":{"h":7,"w":8,"x":0,"y":118},"id":14,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":true,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"alias":"","datasource":"PBFA97CFB590B2093","expr":"irate(logback_events_total{instance=\"$instance\", application=\"$application\", level=\"warn\"}[5m])","format":"time_series","intervalFactor":1,"legendFormat":"warn","rawSql":"SELECT\n  $__time(time_column),\n  value1\nFROM\n  metric_table\nWHERE\n  $__timeFilter(time_column)\n","refId":"A"}],"thresholds":[],"title":"WARN logs","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"format":"none","logBase":1,"show":true},{"format":"short","logBase":1,"show":true}],"yaxis":{"align":false}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"PBFA97CFB590B2093"},"fill":1,"gridPos":{"h":7,"w":8,"x":8,"y":118},"id":16,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":true,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"alias":"","datasource":"PBFA97CFB590B2093","expr":"irate(logback_events_total{instance=\"$instance\", application=\"$application\", level=\"debug\"}[5m])","format":"time_series","intervalFactor":1,"legendFormat":"debug","rawSql":"SELECT\n  $__time(time_column),\n  value1\nFROM\n  metric_table\nWHERE\n  $__timeFilter(time_column)\n","refId":"A"}],"thresholds":[],"title":"DEBUG logs","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"format":"none","logBase":1,"show":true},{"format":"short","logBase":1,"show":true}],"yaxis":{"align":false}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"PBFA97CFB590B2093"},"fill":1,"gridPos":{"h":7,"w":8,"x":16,"y":118},"id":20,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":true,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"alias":"","datasource":"PBFA97CFB590B2093","expr":"irate(logback_events_total{instance=\"$instance\", application=\"$application\", level=\"trace\"}[5m])","format":"time_series","intervalFactor":1,"legendFormat":"trace","rawSql":"SELECT\n  $__time(time_column),\n  value1\nFROM\n  metric_table\nWHERE\n  $__timeFilter(time_column)\n","refId":"A"}],"thresholds":[],"title":"TRACE logs","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"format":"none","logBase":1,"show":true},{"format":"short","logBase":1,"show":true}],"yaxis":{"align":false}}],"refresh":"5s","schemaVersion":38,"style":"dark","tags":[],"templating":{"list":[{"current":{"selected":true,"text":"host.docker.internal:8080","value":"host.docker.internal:8080"},"datasource":{"type":"prometheus","uid":"PBFA97CFB590B2093"},"definition":"label_values(jvm_classes_loaded_classes, instance)","hide":0,"includeAll":false,"label":"Instance","multi":false,"name":"instance","options":[],"query":{"query":"label_values(jvm_classes_loaded_classes, instance)","refId":"StandardVariableQuery"},"refresh":1,"regex":"","skipUrlSync":false,"sort":1,"tagValuesQuery":"","tagsQuery":"","type":"query","useTags":false},{"current":{"selected":true,"text":"api-gateway","value":"api-gateway"},"datasource":{"type":"prometheus","uid":"PBFA97CFB590B2093"},"definition":"label_values(jvm_classes_loaded_classes{instance=\"$instance\"}, application)","hide":0,"includeAll":false,"label":"Application","multi":false,"name":"application","options":[],"query":{"query":"label_values(jvm_classes_loaded_classes{instance=\"$instance\"}, application)","refId":"StandardVariableQuery"},"refresh":1,"regex":"","skipUrlSync":false,"sort":1,"tagValuesQuery":"","tagsQuery":"","type":"query","useTags":false},{"current":{"isNone":true,"selected":false,"text":"None","value":""},"datasource":{"type":"prometheus","uid":"PBFA97CFB590B2093"},"definition":"label_values(hikaricp_connections{instance=\"$instance\", application=\"$application\"}, pool)","hide":0,"includeAll":false,"label":"HikariCP-Pool","multi":false,"name":"hikaricp","options":[],"query":{"query":"label_values(hikaricp_connections{instance=\"$instance\", application=\"$application\"}, pool)","refId":"StandardVariableQuery"},"refresh":1,"regex":"","skipUrlSync":false,"sort":1,"tagValuesQuery":"","tagsQuery":"","type":"query","useTags":false},{"current":{"selected":false,"text":"All","value":"$__all"},"datasource":{"type":"prometheus","uid":"PBFA97CFB590B2093"},"definition":"","hide":0,"includeAll":true,"label":"Memory Pool (heap)","multi":false,"name":"memory_pool_heap","options":[],"query":{"query":"label_values(jvm_memory_used_bytes{application=\"$application\", instance=\"$instance\", area=\"heap\"},id)","refId":"Prometheus-memory_pool_heap-Variable-Query"},"refresh":1,"regex":"","skipUrlSync":false,"sort":1,"tagValuesQuery":"","tagsQuery":"","type":"query","useTags":false},{"current":{"selected":false,"text":"All","value":"$__all"},"datasource":{"type":"prometheus","uid":"PBFA97CFB590B2093"},"definition":"","hide":0,"includeAll":true,"label":"Memory Pool (nonheap)","multi":false,"name":"memory_pool_nonheap","options":[],"query":{"query":"label_values(jvm_memory_used_bytes{application=\"$application\", instance=\"$instance\", area=\"nonheap\"},id)","refId":"Prometheus-memory_pool_nonheap-Variable-Query"},"refresh":1,"regex":"","skipUrlSync":false,"sort":1,"tagValuesQuery":"","tagsQuery":"","type":"query","useTags":false}]},"time":{"from":"now-5m","to":"now"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"","title":"PhotoDom MicroServices","uid":"sOae4vCnk","version":3,"weekStart":""}
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: grafana
spec:
  replicas: 1
  selector:
    matchLabels:
      app: grafana
  template:
    metadata:
      labels:
        app: grafana
    spec:
      containers:
      - name: grafana
        image: grafana/grafana:10.1.0
        ports:
        - containerPort: 3000
        env:
        - name: GF_AUTH_ANONYMOUS_ENABLED
          value: "true"
        - name: GF_AUTH_ANONYMOUS_ORG_ROLE
          value: Admin
        - name: GF_AUTH_DISABLE_LOGIN_FORM
          value: "true"
        volumeMounts:
        - name: grafana-datasources
          mountPath: /etc/grafana/provisioning/datasources
        - name: grafana-dashboard-provider
          mountPath: /etc/grafana/provisioning/dashboards
        - name: grafana-dashboard-config
          mountPath: /etc/grafana/dashboards
        resources:
          requests:
            memory: "128Mi"
            cpu: "100m"
          limits:
            memory: "256Mi"
            cpu: "250m"
      volumes:
      - name: grafana-datasources
        configMap:
          name: grafana-datasources
      - name: grafana-dashboard-provider
        configMap:
          name: grafana-dashboard-provider
      - name: grafana-dashboard-config
        configMap:
          name: grafana-dashboard-config
---
apiVersion: v1
kind: Service
metadata:
  name: grafana
spec:
  selector:
    app: grafana
  ports:
  - port: 3000
    targetPort: 3000
